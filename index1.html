<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuri Monthly Spinner</title>
    <style>
        body { 
            font-family: 'Arial', sans-serif; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            height: 100vh; background: #121212; color: white; margin: 0; 
        }
        .wheel-box { position: relative; width: 350px; height: 350px; }
        #canvas { width: 100%; height: 100%; border-radius: 50%; border: 8px solid white; box-shadow: 0 0 20px rgba(255,255,255,0.2); transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1); }
        .pointer { 
            position: absolute; top: -20px; left: 50%; transform: translateX(-50%); 
            width: 0; height: 0; border-left: 20px solid transparent; 
            border-right: 20px solid transparent; border-top: 40px solid #ff0000; z-index: 10;
        }
        button { 
            margin-top: 40px; padding: 15px 45px; font-size: 20px; cursor: pointer; 
            background: #27ae60; color: white; border: none; border-radius: 50px; font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        button:active { transform: scale(0.95); }
        #msg { margin-top: 25px; font-size: 20px; color: #f1c40f; text-align: center; font-weight: bold; min-height: 60px; padding: 0 20px; }
    </style>
</head>
<body>

    <h1>üéØ KURI SPINNER</h1>
    <div id="msg">READY FOR DRAW</div>

    <div class="wheel-box">
        <div class="pointer"></div>
        <canvas id="canvas" width="500" height="500"></canvas>
    </div>

    <button id="spinBtn" onclick="handleSpin()">SPIN NOW</button>

    <script>
        const names = ["Backer1", "Baker2", "Anas", "Amir1", "Razik", "Shuhaib", "Amir2", "Basheer", "Bharath", "Amir3", "Lukku", "Abdulla"];
        const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const msg = document.getElementById('msg');

        const currentMonthIdx = new Date().getMonth(); 
        const currentMonthName = months[currentMonthIdx];
        const storageKey = "kuri_winner_" + currentMonthName;

        function draw() {
            const arc = (2 * Math.PI) / 12;
            for (let i = 0; i < 12; i++) {
                ctx.beginPath();
                ctx.fillStyle = (i % 2 === 0) ? '#ffcc00' : '#ff9900';
                ctx.moveTo(250, 250);
                ctx.arc(250, 250, 250, i * arc, (i + 1) * arc);
                ctx.fill();
                ctx.strokeStyle = "#333";
                ctx.stroke();

                ctx.save();
                ctx.translate(250, 250);
                ctx.rotate(i * arc + arc / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#000";
                ctx.font = "bold 22px Arial";
                ctx.fillText(names[i], 230, 10);
                ctx.restore();
            }
        }

        draw();

        let isSpinning = false;

        function handleSpin() {
            if (isSpinning) return;

            const savedWinner = localStorage.getItem(storageKey);
            
            // Re-draw check
            if (savedWinner) {
                alert(`The ${currentMonthName} month is ${savedWinner} winner already published.`);
                msg.innerText = `The ${currentMonthName} month is ${savedWinner} winner already published.`;
                return;
            }

            // Start Spinning
            isSpinning = true;
            msg.innerText = "Spinning...";

            const segmentDeg = 360 / 12;
            // Target is the current month's winner index
            const stopDeg = 360 - (currentMonthIdx * segmentDeg) - (segmentDeg / 2) + 270;
            const totalRotation = 3600 + stopDeg; 

            canvas.style.transform = `rotate(${totalRotation}deg)`;

            setTimeout(() => {
                const winner = names[currentMonthIdx];
                localStorage.setItem(storageKey, winner);
                msg.innerHTML = `<span style="font-size:28px; color:#00ff00;">üèÜ WINNER: ${winner} üèÜ</span>`;
                isSpinning = false;
            }, 5200);
        }
    </script>
</body>
</html>